<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#0a0a0f">
    <title>OKTOPUS | Lead Capture</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
    
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
    <!-- Canvas Confetti for lead-save celebrations -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
</head>
<body>

    <!-- Animated Background -->
    <div class="bg-effects">
        <div class="bg-gradient"></div>
        <div class="bg-glow glow-1"></div>
        <div class="bg-glow glow-2"></div>
        <div class="bg-glow glow-3"></div>
        <div class="bg-grid"></div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="logo" onclick="App.showSection('new')">
            <div class="logo-icon">
                <svg viewBox="0 0 32 32"><circle cx="16" cy="16" r="14" fill="none" stroke="url(#logoGrad)" stroke-width="2.5"/><path d="M16 8 L16 24 M8 16 L24 16 M11 11 L21 21 M21 11 L11 21" stroke="url(#logoGrad)" stroke-width="1.5" stroke-linecap="round" opacity="0.6"/><circle cx="16" cy="16" r="4" fill="url(#logoGrad)"/><defs><linearGradient id="logoGrad" x1="0" y1="0" x2="32" y2="32"><stop offset="0%" stop-color="#FF9B37"/><stop offset="100%" stop-color="#FF5722"/></linearGradient></defs></svg>
            </div>
            <div class="logo-text">OKTO<span>PUS</span></div>
        </div>
        <div class="header-right">
            <div class="event-pill" id="eventBadge">IFAT Munich 2026</div>
            <div class="lead-counter">
                <div class="counter-pulse"></div>
                <span class="counter-number" id="leadCount">0</span>
                <span class="counter-label">Leads</span>
            </div>
            <button class="auth-btn" id="authStatus" onclick="handleAuthClick()">
                <div class="auth-indicator" id="authDot"></div>
                <span id="authLabel">Offline</span>
            </button>
        </div>
    </header>

    <!-- Status Toast -->
    <div class="toast" id="statusBar">
        <div class="toast-icon" id="toastIcon">
            <svg viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>
        </div>
        <span class="toast-text" id="statusText">Gespeichert</span>
    </div>

    <!-- Main Content -->
    <main class="main">
        
        <!-- ==================== NEW LEAD ==================== -->
        <section class="section active" id="section-new">
            
            <!-- Quick Stats Bar -->
            <div class="quick-stats">
                <div class="quick-stat">
                    <span class="qs-value" id="qsTotal">0</span>
                    <span class="qs-label">Gesamt</span>
                </div>
                <div class="qs-divider"></div>
                <div class="quick-stat">
                    <span class="qs-value hot" id="qsHot">0</span>
                    <span class="qs-label">Hot</span>
                </div>
                <div class="qs-divider"></div>
                <div class="quick-stat">
                    <span class="qs-value" id="qsToday">0</span>
                    <span class="qs-label">Heute</span>
                </div>
                <div class="qs-divider"></div>
                <div class="quick-stat">
                    <span class="qs-value sent" id="qsEmails">0</span>
                    <span class="qs-label">E-Mails</span>
                </div>
            </div>
            
            <!-- Camera Card -->
            <div class="glass-card animate-in">
                <div class="card-header-fancy">
                    <div class="card-icon">ğŸ“¸</div>
                    <div>
                        <h3>Visitenkarte scannen</h3>
                        <p>OCR-Texterkennung direkt im Browser</p>
                    </div>
                </div>
                <div class="card-body">
                    <div class="camera-zone" id="cameraZone" onclick="CameraModule.init()">
                        <div class="camera-ring">
                            <svg viewBox="0 0 24 24"><path d="M12 15.2a3.2 3.2 0 100-6.4 3.2 3.2 0 000 6.4z"/><path d="M9 2L7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2H9zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z"/></svg>
                        </div>
                        <div class="camera-label" id="cameraTitle">Antippen zum Scannen</div>
                        <div class="camera-sub" id="cameraDesc">Visitenkarte ins Bild halten</div>
                    </div>
                    <div class="camera-preview" id="cameraPreview">
                        <video id="cameraVideo" autoplay playsinline></video>
                        <canvas id="cameraCanvas" style="display:none;"></canvas>
                        <img id="capturedImage" style="display:none;">
                    </div>
                    <div class="camera-actions" id="cameraActions" style="display:none;">
                        <button class="btn btn-ghost" onclick="CameraModule.retake()">â†º Neu</button>
                        <button class="btn btn-accent" onclick="CameraModule.capture()">ğŸ“· Aufnehmen</button>
                    </div>
                    <div class="ocr-progress" id="ocrProgress">
                        <div class="ocr-ring"><div class="ocr-ring-inner"></div></div>
                        <span class="ocr-text" id="ocrText">Texterkennung lÃ¤uft...</span>
                        <span class="ocr-percent" id="ocrPercent">0%</span>
                    </div>
                </div>
            </div>
            
            <!-- Contact Form -->
            <div class="glass-card animate-in" style="animation-delay: 0.05s;">
                <div class="card-header-fancy">
                    <div class="card-icon">ğŸ‘¤</div>
                    <div>
                        <h3>Kontaktdaten</h3>
                        <p>Pflichtfelder sind markiert</p>
                    </div>
                </div>
                <div class="card-body">
                    <div class="form-row triple">
                        <div class="form-group">
                            <label>Anrede</label>
                            <select class="form-control" id="salutation">
                                <option value="">â€”</option>
                                <option value="Herr">Herr</option>
                                <option value="Frau">Frau</option>
                                <option value="Divers">Divers</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Titel</label>
                            <select class="form-control" id="title">
                                <option value="">â€”</option>
                                <option value="Dr.">Dr.</option>
                                <option value="Prof.">Prof.</option>
                                <option value="Prof. Dr.">Prof. Dr.</option>
                                <option value="Dipl.-Ing.">Dipl.-Ing.</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Vorname *</label>
                            <input type="text" class="form-control" id="firstName" placeholder="Max">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Nachname *</label>
                            <input type="text" class="form-control" id="lastName" placeholder="Mustermann">
                        </div>
                        <div class="form-group">
                            <label>Unternehmen *</label>
                            <input type="text" class="form-control" id="company" placeholder="Firma GmbH">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Position</label>
                            <input type="text" class="form-control" id="jobTitle" placeholder="Leiter Einkauf">
                        </div>
                        <div class="form-group">
                            <label>E-Mail *</label>
                            <input type="email" class="form-control" id="email" placeholder="max@firma.de">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Telefon</label>
                            <input type="tel" class="form-control" id="phone" placeholder="+49 89 12345">
                        </div>
                        <div class="form-group">
                            <label>Mobil</label>
                            <input type="tel" class="form-control" id="mobile" placeholder="+49 170 12345">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Website</label>
                            <input type="url" class="form-control" id="website" placeholder="www.firma.de">
                        </div>
                        <div class="form-group">
                            <label>Adresse</label>
                            <input type="text" class="form-control" id="address" placeholder="Musterstr. 1, 80331 MÃ¼nchen">
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Interests -->
            <div class="glass-card animate-in" style="animation-delay: 0.1s;">
                <div class="card-header-fancy">
                    <div class="card-icon">ğŸ¯</div>
                    <div>
                        <h3>Interesse an</h3>
                        <p>Bestimmt den zustÃ¤ndigen Vertrieb</p>
                    </div>
                </div>
                <div class="card-body">
                    <div class="interest-grid" id="interestsGrid"></div>
                </div>
            </div>
            
            <!-- BANT Qualification -->
            <div class="glass-card animate-in" style="animation-delay: 0.15s;">
                <div class="card-header-fancy">
                    <div class="card-icon">ğŸ”¥</div>
                    <div>
                        <h3>Lead-Qualifizierung</h3>
                        <p>BANT-Score bestimmt die PrioritÃ¤t</p>
                    </div>
                </div>
                <div class="card-body">
                    <div class="bant-grid">
                        <div class="bant-card">
                            <div class="bant-emoji">ğŸ’°</div>
                            <div class="bant-title">Budget</div>
                            <select class="form-control bant-select" id="bantBudget">
                                <option value="">â€”</option>
                                <option value="vorhanden">âœ… Vorhanden</option>
                                <option value="geplant">ğŸ“‹ Geplant</option>
                                <option value="offen">â“ Offen</option>
                            </select>
                        </div>
                        <div class="bant-card">
                            <div class="bant-emoji">ğŸ‘‘</div>
                            <div class="bant-title">Entscheider</div>
                            <select class="form-control bant-select" id="bantAuthority">
                                <option value="">â€”</option>
                                <option value="entscheider">â­ Entscheider</option>
                                <option value="beeinflusser">ğŸ”„ Beeinflusser</option>
                                <option value="anwender">ğŸ‘¤ Anwender</option>
                            </select>
                        </div>
                        <div class="bant-card">
                            <div class="bant-emoji">ğŸ“Š</div>
                            <div class="bant-title">Bedarf</div>
                            <select class="form-control bant-select" id="bantNeed">
                                <option value="">â€”</option>
                                <option value="dringend">ğŸ”´ Dringend</option>
                                <option value="konkret">ğŸŸ¡ Konkret</option>
                                <option value="zukunft">ğŸŸ¢ ZukÃ¼nftig</option>
                            </select>
                        </div>
                        <div class="bant-card">
                            <div class="bant-emoji">â±ï¸</div>
                            <div class="bant-title">Zeitraum</div>
                            <select class="form-control bant-select" id="bantTiming">
                                <option value="">â€”</option>
                                <option value="sofort">ğŸš€ Sofort</option>
                                <option value="quartal">ğŸ“… Dieses Quartal</option>
                                <option value="jahr">ğŸ“† Dieses Jahr</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Notes -->
            <div class="glass-card animate-in" style="animation-delay: 0.2s;">
                <div class="card-header-fancy">
                    <div class="card-icon">ğŸ“</div>
                    <div>
                        <h3>GesprÃ¤chsnotizen</h3>
                        <p>Was wurde besprochen?</p>
                    </div>
                </div>
                <div class="card-body">
                    <textarea class="form-control form-textarea" id="notes" placeholder="Key Points, nÃ¤chste Schritte, besondere Anforderungen..."></textarea>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="action-bar">
                <button class="btn btn-ghost btn-lg" onclick="App.resetForm()">
                    â†º ZurÃ¼cksetzen
                </button>
                <button class="btn btn-glow btn-lg" onclick="App.saveLead()" id="saveBtn">
                    <span class="btn-shine"></span>
                    âœ¨ Lead erfassen
                </button>
            </div>
        </section>
        
        <!-- ==================== LEADS LIST ==================== -->
        <section class="section" id="section-leads">
            <div class="leads-hero">
                <div>
                    <h2 class="leads-title">Leads</h2>
                    <p class="leads-subtitle"><span id="leadsCount">0</span> Kontakte erfasst</p>
                </div>
                <div class="leads-actions">
                    <button class="btn btn-ghost btn-sm" onclick="App.exportCSV()">
                        ğŸ“¥ CSV Export
                    </button>
                </div>
            </div>
            
            <div class="search-bar">
                <svg viewBox="0 0 24 24"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
                <input type="text" id="searchInput" placeholder="Name, Firma oder E-Mail suchen..." oninput="App.filterLeads()">
            </div>
            
            <div id="leadsList"></div>
        </section>
        
        <!-- ==================== SETTINGS ==================== -->
        <section class="section" id="section-settings">
            
            <div class="settings-group">
                <div class="settings-title">ğŸ“§ E-Mail-Konto</div>
                <div class="settings-card">
                    <div class="sc-row">
                        <div class="sc-icon"><svg viewBox="0 0 24 24"><path d="M3 3h8v8H3V3zm2 2v4h4V5H5zm8-2h8v8h-8V3zm2 2v4h4V5h-4zM3 13h8v8H3v-8zm2 2v4h4v-4H5z"/></svg></div>
                        <div class="sc-content">
                            <div class="sc-label" id="msStatusLabel">Nicht verbunden</div>
                            <div class="sc-desc" id="msStatusDesc">Mit Microsoft anmelden</div>
                        </div>
                        <button class="btn btn-accent btn-sm" id="msLoginBtn" onclick="handleAuthClick()">Verbinden</button>
                    </div>
                </div>
            </div>
            
            <div class="settings-group">
                <div class="settings-title">ğŸª Veranstaltung</div>
                <div class="settings-card">
                    <div class="sc-row">
                        <div class="sc-icon">ğŸ“</div>
                        <div class="sc-content">
                            <div class="sc-label">Event Name</div>
                            <input type="text" class="form-control settings-input" id="settingsEvent" value="IFAT Munich 2026" onchange="App.saveSettings()">
                        </div>
                    </div>
                    <div class="sc-row">
                        <div class="sc-icon">ğŸ¢</div>
                        <div class="sc-content">
                            <div class="sc-label">Standnummer</div>
                            <input type="text" class="form-control settings-input" id="settingsStand" placeholder="Halle 5, Stand A42" onchange="App.saveSettings()">
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="settings-group">
                <div class="settings-title">âš¡ Automatisierung</div>
                <div class="settings-card">
                    <div class="sc-row">
                        <div class="sc-icon">ğŸ“§</div>
                        <div class="sc-content">
                            <div class="sc-label">Auto Willkommens-E-Mail</div>
                            <div class="sc-desc">Vertriebler im CC je nach Interesse</div>
                        </div>
                        <div class="toggle" id="toggleEmail" onclick="App.toggleSetting('email')"></div>
                    </div>
                    <div class="sc-row">
                        <div class="sc-icon">ğŸ“…</div>
                        <div class="sc-content">
                            <div class="sc-label">Auto Follow-up Termin</div>
                            <div class="sc-desc">Outlook-Termin in 3 Tagen</div>
                        </div>
                        <div class="toggle" id="toggleCalendar" onclick="App.toggleSetting('calendar')"></div>
                    </div>
                </div>
            </div>
            
            <div class="settings-group">
                <div class="settings-title">ğŸ“Š Statistiken</div>
                <div class="settings-card">
                    <div class="stats-grid">
                        <div class="stat-box">
                            <div class="stat-number" id="statsTotal">0</div>
                            <div class="stat-label">Gesamt</div>
                        </div>
                        <div class="stat-box hot">
                            <div class="stat-number" id="statsHot">0</div>
                            <div class="stat-label">Hot Leads</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-number" id="statsEmails">0</div>
                            <div class="stat-label">E-Mails</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-number" id="statsFollowups">0</div>
                            <div class="stat-label">Follow-ups</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="settings-group">
                <div class="settings-title">ğŸ”§ System</div>
                <div class="settings-card">
                    <div class="sc-row">
                        <div class="sc-icon">ğŸ–¥ï¸</div>
                        <div class="sc-content">
                            <div class="sc-label">Backend API</div>
                            <div class="sc-desc" id="apiStatusDesc">PrÃ¼fe...</div>
                        </div>
                        <div class="sc-value" id="apiStatusValue">...</div>
                    </div>
                </div>
                <button class="btn btn-danger btn-block" onclick="App.clearAllData()" style="margin-top: 12px;">ğŸ—‘ï¸ Alle lokalen Daten lÃ¶schen</button>
            </div>
        </section>
    </main>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <button class="nav-tab active" onclick="App.showSection('new')" data-section="new">
            <div class="nav-icon"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 11h-4v4h-2v-4H7v-2h4V7h2v4h4v2z"/></svg></div>
            <span>Erfassen</span>
        </button>
        <button class="nav-tab" onclick="App.showSection('leads')" data-section="leads">
            <div class="nav-icon"><svg viewBox="0 0 24 24"><path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/></svg></div>
            <span>Leads</span>
        </button>
        <button class="nav-tab" onclick="App.showSection('settings')" data-section="settings">
            <div class="nav-icon"><svg viewBox="0 0 24 24"><path d="M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg></div>
            <span>Settings</span>
        </button>
    </nav>

    <script src="js/api.js"></script>
    <script src="js/camera.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
